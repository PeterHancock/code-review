<!DOCTYPE html>
<html>
    <head>
        <title>Code Review
        </title>
        <link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap.min.css">
        <link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap-theme.min.css">
        <script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js" ></script>
        <script src="//netdna.bootstrapcdn.com/bootstrap/3.0.0/js/bootstrap.min.js"></script>
        <script src="//cdnjs.cloudflare.com/ajax/libs/underscore.js/1.5.1/underscore-min.js"></script>
        <script src="//cdnjs.cloudflare.com/ajax/libs/mustache.js/0.7.2/mustache.min.js"></script>
        <script src="//cdnjs.cloudflare.com/ajax/libs/backbone.js/1.0.0/backbone-min.js"></script>
        <script type='text/javascript' src='//cdn.firebase.com/v0/firebase.js'></script>
        <script type='text/javascript' src='//cdn.firebase.com/v0/firebase-simple-login.js'> </script>        
        <script src="js/shuffle.js"></script>
        <script>
        (function(){
            var global = this;
            $(function(){
                var codeReviewRef = global.app = new Firebase('code-review-auth.firebaseio.com');
                var auth = global.auth = new FirebaseSimpleLogin(codeReviewRef, function(error, user) {
                    console.log('auth', error, user);
                    if(!error) {
                    }
                    if(user) {
                        render(user);
                    }
                });        

                $('#github').click(function(e){
                    e.preventDefault();    
                    auth.login('github', {rememberMe:true});
                });
     
                $('#password').click(function(e){
                    e.preventDefault();    
                    auth.login('password', {email:'peter.hancock@gmail.com', password: 'password'});
                });
                $('#logout').click(function(e){
                    e.preventDefault();    
                    auth.logout();
                });
               
                function render(user) {
                    var userNode = codeReviewRef.child('users/' + user.id);
                    var userName = userNode.child('name');
                    userName.transaction(function(val) { 
                        if (val == null) {
                            val = user.username || user.email;
                        }
                        return val;
                    });
                    userName.on('value', function(snapshot) {
                        console.log('name', snapshot.val());
                    });
                    userNode.child('messages').on('value', function(snapshot) { console.log('messages:',snapshot.val()) });
                    
                } 
            });
        }).call(this);
        </script>
    </head>
    <body>

    <a href="#" id="github">Github Login</a>
    <a href="#" id="password">peter.hancock@gmail.com:password</a>
    <a href="#" id="logout">Logout</a>
</body>
</html>

